<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>Messaging Infrastructure Overview</title>
</head>
<body>
<span style="font-family: serif;"></span><a href="../index.html">Index</a>
<hr style="width: 100%; height: 2px;">
<h3>Messaging Infrastructure Overview</h3>
The messaging infrastructure is a framework written in Java used to
communicate with a JMS compliant messaging system such as <a
 href="http://activemq.codehaus.org/">ActiveMQ</a>.<br>
<br>
Currently the messaging infrastructure supports the following messaging
systems:<br>
<ul>
  <li><a href="http://activemq.codehaus.org/">ActiveMQ</a></li>
  <li><a href="http://wiki.jboss.org/wiki/Wiki.jsp?page=JBossMQ">JBossMQ</a></li>
  <li><a href="http://joram.objectweb.org/">JORAM</a></li>
  <li><a href="http://openjms.sourceforge.net/">Open JMS</a></li>
  <li><a href="http://mom4j.sourceforge.net/index.html">Mom4J<br>
    </a></li>
</ul>
The messaging infrastructure has the following features:<br>
<ul>
  <li>Handles both XML and binary messages.</li>
  <li>Compresses binary messages if required.</li>
  <li>Validates XML messages against XSD schemas if required.</li>
  <li>Wraps the XML messages in SOAP envelopes if required.</li>
  <li>Pool and limit the number of connections to the messaging system.</li>
</ul>
The messaging infrastructure is best suited to send XML messages
between applications and send binary messages from one application to
another.<br>
<br>
Currently this infrastructure deals with point-to-point messaging using
queues. It could easily be extended to deal with publish/subscribe
messaging using topics.<br>
<h4>Asynchronous Messaging</h4>
Asynchronous messages are those where the client application is only
interested in sending data to another application and is not expecting
a reply: <br>
<br>
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+-----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+-----------+</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp; App 1&nbsp;&nbsp; | ====&gt; Queue ====&gt; |&nbsp;&nbsp;
App 2&nbsp;&nbsp; |</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+-----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+-----------+</span><br style="font-family: monospace;">
<br>
The acknowledgement of the delivery of the message is the successful
putting of the message onto the queue as there is guaranteed delivery
ie as far as Application 1 is concerned the message has been delivered
to Application 2 if Application 1 has put the message successfully onto
the queue. No direct response from Application 2 is required.<br>
<br>
The messaging infrastructure calls this scenario "submit".<br>
<br>
Sending binary data from one application to another would fit this
scenario.<br>
<h4>Synchronous Messaging</h4>
Synchronous messages are those where the client application is
interested in getting some data from another application. The client
puts a "request" onto one queue and waits for a "reply" on another
queue:<br>
<br>
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+-----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+-----------+</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
====&gt; Queue 1 ====&gt;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp; App 1&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp; App 2&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
&lt;==== Queue 2 &lt;====
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+-----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+-----------+</span><br style="font-family: monospace;">
<br>
Application 1 puts a message onto Queue 1 (the "request" queue) and
waits for the reply on Queue 2 (the "reply" queue). Meanwhile
Application 2 picks up the request message, deals with it, and put the
reply onto Queue 2 for Application 1 to pick up.<br>
<br>
The messaging infrastructure calls this scenario "request-reply".<br>
<br>
The situation where Application 1 sends an XML request to Application 2
and then waits for an XML reply from Application 2 would fit this
scenario.<br>
<br>
In Java, Application 2 could be a message drive bean deployed in an EJB
or Spring container. This bean would implement the <span
 style="font-family: monospace;">javax.jms.MessageListener</span>
interface to listen to the messages as they arrive on the request queue.<br>
<br>
This scenario best suits the sending of XML requests and getting XML
responses.<br>
<h4>Messaging Infrastructure Architecture</h4>
<hr style="width: 100%; height: 2px;">Coming Soon...<br>
<hr style="width: 100%; height: 2px;">The messaging infrastructure is
configured by an XML file.<br>
<br>
When the messaging infrastructure starts up it looks for an <span
 style="font-family: monospace;">msginf.xml</span> file in the class
path by default or uses the following Java property set on the command
line: <br>
<br>
<span style="font-family: monospace;">-Dmsginf.xmlpropertiesfile=/somepath/mymessagingfile.xml</span><br>
<br>
This file will need to be edited to suit your environment.<br>
<br>
Details of this file are in the <a href="#The_Configuration_XML_File">Configuration
XML File</a> section below.<br>
<br>
When the messaging infrastructure receives its first message it starts
up all the connections automatically using the information in the
properties file and then sends the message.<br>
<h4><a name="Building_the_Messaging_Infrastructure"></a>Building the
Messaging Infrastructure</h4>
In order to build the messaging infrastructure, <a
 href="http://subversion.tigris.org/">SVN</a> and <a
 href="http://ant.apache.org/">Ant</a> will need to be installed on
your PC.<br>
<br>
The source code for the messaging infrastructure is in SVN at: <span
 style="font-family: monospace;">http://updraft/svn/dm2repos/unisys/messaging/trunk/Implementation/Project/msginf</span><br>
<br>
Check the code out to a directory (referred to as <span
 style="font-family: monospace;">MSGINF_HOME</span>).<br>
<br>
The following Ant targets can be run from the <span
 style="font-family: monospace;">MSGINF_HOME</span> directory:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Ant Target Name</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">clean</td>
      <td style="vertical-align: top;">Deletes the <span
 style="font-family: monospace;">MSGINF_HOME/build</span> and <span
 style="font-family: monospace;">MSGINF_HOME/dist</span> directories.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">compile</td>
      <td style="vertical-align: top;">Compiles the code into the <span
 style="font-family: monospace;">MSGINF_HOME/build/classes</span>
directory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">jar</td>
      <td style="vertical-align: top;">Creates the <span
 style="font-family: monospace;">MSGINF_HOME/dist/msginf.jar</span>
file from the compiled source code.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">junit_activemq</td>
      <td style="vertical-align: top;">Runs the ActiveMQ junit tests.
Results are in the <span style="font-family: monospace;">MSGINF/build/junit</span>
directory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">junit_jboss</td>
      <td style="vertical-align: top;">Runs the JBoss junit tests.
Results are in the <span style="font-family: monospace;">MSGINF/build/junit</span>
directory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">junit_joram</td>
      <td style="vertical-align: top;">Runs the JORAM junit tests.
Results are in the <span style="font-family: monospace;">MSGINF/build/junit</span>
directory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">javadocs</td>
      <td style="vertical-align: top;">Creates the javadocs from the
source in the <span style="font-family: monospace;">MSGINF_HOME/build/javadocs/api</span>
directory. Also creates <span style="font-family: monospace;">MSGINF_HOME/dist/msginf-javadocs.jar</span>.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">makeconfigtool</td>
      <td style="vertical-align: top;">Creates the XML configuration
file editor application in the <span style="font-family: monospace;">MSGINF_HOME/build/config</span>
directory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span
 style="font-family: monospace;">makeviewer</span><br>
      </td>
      <td style="vertical-align: top;">Creates the <a
 href="MessageViewer.html">message viewer application</a> in the <span
 style="font-family: monospace;">MSGINF_HOME/build/viewer</span>
directory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">test</td>
      <td style="vertical-align: top;">Creates the test code and
scripts in the <span style="font-family: monospace;">MSGINF_HOME/build/test</span>
directory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">war</td>
      <td style="vertical-align: top;">Creates the <span
 style="font-family: monospace;">MSGINF_HOME/dist/msginf.war</span> web
application file.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">all_messagelisteners</td>
      <td style="vertical-align: top;">Creates the message listeners
and receivers for all the supported environments in the <span
 style="font-family: monospace;">MSGINF_HOME/build/env</span> directory.</td>
    </tr>
  </tbody>
</table>
<br>
The <span style="font-family: monospace;">msginf.war</span> can be
deployed to Tomcat to allow clients to communicate with the <a
 href="MessagingInfrastructureHTTP.html">messaging infrastructure using
HTTP</a>.<br>
<br>
<a href="MessagingInfrastructureTests.html">This page</a> outlines how
to setup and run the messaging infrastructure tests.<br>
<h4><a name="The_Configuration_XML_File"></a>The Configuration XML File</h4>
The <span style="font-family: monospace;">MSGINF_HOME/src/msginf.xml</span>
file contains all the information required by the messaging
infrastructure to start up, where to send messages, and how to deal
with the messages. <br>
<br>
The <span style="font-family: monospace;">makeconfigtool</span> target
above creates a Swing application which can be used to create and edit
XML properties files.<br>
<br>
<font size="+2"><span style="font-weight: bold; color: rgb(204, 0, 0);">The
<span style="font-family: monospace;">msginf.xml</span> file will need
to be edited to suit your environment before any tests can be run.</span></font><br>
<br>
An example of the <span style="font-family: monospace;">msginf.xml</span>
file can be found <a href="ExampleMsgInfXML.html">here</a>.<br>
<br>
The <span style="font-family: monospace;">msginf.xml</span> file can
have multiple messaging systems defined and each messaging system can
have multiple connectors. The <span style="font-family: monospace;">MSGINF_HOME/xmlbeans/msginf.xsd</span>
file is the <a href="MessagingInfrastructureXMLBeans.html">schema</a>
for the <span style="font-family: monospace;">msginf.xml</span> file.<br>
<br>
The attributes in the <span style="font-family: monospace;">emi:configuration</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:log4jPropertiesFile</td>
      <td style="vertical-align: top; font-family: monospace;">/home/fred/log4j2.properties</td>
      <td style="vertical-align: top;">The absolute location of the
log4j
properties file. If this file cannot be found, the first <span
 style="font-family: monospace;">log4j2.properties</span> file found in
the classpath will be used.<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
The attributes in the <span style="font-family: monospace;">emi:system</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:name</td>
      <td style="vertical-align: top; font-family: monospace;">activemq</td>
      <td style="vertical-align: top;">The name of the messaging
system. This is the name used when
constructing the <span style="font-family: monospace;">QueueManager</span>
object as outlined in the <a
 href="#Calling_the_Messaging_Infrastructure">Calling the
Messaging Infrastructure</a> section.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:initialContextFactory</td>
      <td style="vertical-align: top; font-family: monospace;">org.apache.activemq.jndi.ActiveMQInitialContextFactory</td>
      <td style="vertical-align: top;">The ActiveMQ JNDI initial
context factory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:url</td>
      <td style="vertical-align: top; font-family: monospace;">tcp://localhost:61616</td>
      <td style="vertical-align: top;">The URL of the ActiveMQ server.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:host</td>
      <td style="vertical-align: top; font-family: monospace;">localhost</td>
      <td style="vertical-align: top;">The host name of the server.
JORAM only.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:port</td>
      <td style="vertical-align: top; font-family: monospace;">16400</td>
      <td style="vertical-align: top;">The port of the server. JORAM
only.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:namingFactoryUrlPkgs</td>
      <td style="vertical-align: top; font-family: monospace;">org.jnp.interfaces:org.jboss.naming</td>
      <td style="vertical-align: top;">The naming factory url packages.
JBossMQ only.<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
The <span style="font-family: monospace;">emi:jarFiles</span> element
contains the paths to each of the third party jar files used by the
messaging system. Each jar file has a <span
 style="font-family: monospace;">emi:jarFile</span> element. The
attributes in the <span style="font-family: monospace;">emi:jarFile</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:jarFileName</td>
      <td style="vertical-align: top; font-family: monospace;">/home/alisdairh/java/activemq-3.1/lib/activemq-core-3.1.jar</td>
      <td style="vertical-align: top;">The jar file path and name.</td>
    </tr>
  </tbody>
</table>
<br>
The attributes in the <span style="font-family: monospace;">emi:queue</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:jndiName</td>
      <td style="vertical-align: top; font-family: monospace;">TestQueue</td>
      <td style="vertical-align: top;">The JNDI name of the queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:physicalName</td>
      <td style="vertical-align: top; font-family: monospace;">SUBMIT.QUEUE</td>
      <td style="vertical-align: top;">The physical name of the queue.<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
Queue definitions are only required for ActiveMQ.<br>
<br>
The attributes in the <span style="font-family: monospace;">emi:connectors</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:useConnectionPooling</td>
      <td style="vertical-align: top; font-family: monospace;">true</td>
      <td style="vertical-align: top;">Use connection pooling.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:minConnections</td>
      <td style="vertical-align: top;"><span
 style="font-family: monospace;">5</span><br>
      </td>
      <td style="vertical-align: top;">The minimum number of
connections in the connection pool.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:maxConnections</td>
      <td style="vertical-align: top;"><span
 style="font-family: monospace;">20</span><br>
      </td>
      <td style="vertical-align: top;">The maximum number of
connections in the connection pool.</td>
    </tr>
  </tbody>
</table>
<br>
The attributes in the <span style="font-family: monospace;">emi:submit</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:connectorName</td>
      <td style="vertical-align: top; font-family: monospace;">activemq_submit_text</td>
      <td style="vertical-align: top;">The name of the submit
connector. Used by the <span style="font-family: monospace;">QueueManager.sendMessage</span>
method as outlined in the <a
 href="#Calling_the_Messaging_Infrastructure">Calling the
Messaging Infrastructure</a> section.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:mimeType</td>
      <td style="vertical-align: top; font-family: monospace;">text/xml</td>
      <td style="vertical-align: top;">The mime type for String based
messages.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:submitSchema</td>
      <td style="vertical-align: top; font-family: monospace;">http://localhost/test
http://localhost/schema/test.xsd</td>
      <td style="vertical-align: top;">The XSD schema to validate
submit messages against.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:validateSubmit</td>
      <td style="vertical-align: top; font-family: monospace;">false</td>
      <td style="vertical-align: top;">Whether to validate the messages
sent to the submit queue against the submit XSD schema.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:putValidationErrorOnDeadLetterQueue</td>
      <td style="vertical-align: top; font-family: monospace;">false</td>
      <td style="vertical-align: top;">Whether to put any messages
which fail validation onto the dead letter queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:compressBinaryMessages</td>
      <td style="vertical-align: top; font-family: monospace;">false</td>
      <td style="vertical-align: top;">Whether to compress binary
messages put onto the submit queue using GZIP.</td>
    </tr>
  </tbody>
</table>
<br>
The attributes in the <span style="font-family: monospace;">emi:soap</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:sourceName</td>
      <td style="vertical-align: top; font-family: monospace;">Message
Source</td>
      <td style="vertical-align: top;">Arbitrary name for the connector
source.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:destinationName</td>
      <td style="vertical-align: top; font-family: monospace;">Message
Destination</td>
      <td style="vertical-align: top;">Arbitrary name for the connector
destination.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:useSOAPEnvelope</td>
      <td style="vertical-align: top; font-family: monospace;">false</td>
      <td style="vertical-align: top;">Whether to wrap the XML messages
in a SOAP envelope.</td>
    </tr>
  </tbody>
</table>
<br>
The attributes in the <span style="font-family: monospace;">emi:submit-connection</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:submitQueueName</td>
      <td style="vertical-align: top; font-family: monospace;">TestQueue</td>
      <td style="vertical-align: top;">The JNDI name of the submit
queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:deadLetterQueueName</td>
      <td style="vertical-align: top; font-family: monospace;">DeadLetterQueue</td>
      <td style="vertical-align: top;">The JNDI name of the dead letter
queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:submitQueueConnFactoryName</td>
      <td style="vertical-align: top; font-family: monospace;">QueueConnectionFactory</td>
      <td style="vertical-align: top;">The JNDI name of the queue
connection factory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:messageClassName</td>
      <td style="vertical-align: top; font-family: monospace;">javax.jms.TextMessage</td>
      <td style="vertical-align: top;">The type of message which will
be put onto the submit queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:messageTimeToLive</td>
      <td style="vertical-align: top; font-family: monospace;">0<br>
      </td>
      <td style="vertical-align: top;">The time in milliseconds that
the message will stay alive on the queue before being deleted. <span
 style="font-family: monospace;">0</span> means forever.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:replyWaitTime</td>
      <td style="vertical-align: top; font-family: monospace;">20000<br>
      </td>
      <td style="vertical-align: top;">Not required for submit but set
anyway.</td>
    </tr>
  </tbody>
</table>
<br>
The attributes in the <span style="font-family: monospace;">emi:request-reply</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:connectorName</td>
      <td style="vertical-align: top; font-family: monospace;">activemq_rr_text</td>
      <td style="vertical-align: top;">The name of the request-reply
connector. Used by the <span style="font-family: monospace;">QueueManager.sendMessage</span>
method as outlined in the <a
 href="#Calling_the_Messaging_Infrastructure">Calling the
Messaging Infrastructure</a> section.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:mimeType</td>
      <td style="vertical-align: top; font-family: monospace;">text/xml</td>
      <td style="vertical-align: top;">The mime type for String based
messages.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:requestSchema</td>
      <td style="vertical-align: top; font-family: monospace;">http://localhost/test
http://localhost/schema/test.xsd</td>
      <td style="vertical-align: top;">The XSD schema to validate
request messages against.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:replySchema</td>
      <td style="vertical-align: top; font-family: monospace;">http://localhost/test
http://localhost/schema/test.xsd</td>
      <td style="vertical-align: top;">The XSD schema to validate reply
messages against.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:validateRequest</td>
      <td style="vertical-align: top; font-family: monospace;">false<br>
      </td>
      <td style="vertical-align: top;">Whether to validate the messages
sent to the request queue against the request XSD schema.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:validateReply</td>
      <td style="vertical-align: top; font-family: monospace;">false</td>
      <td style="vertical-align: top;">Whether to validate the messages
received from the reply queue against the reply XSD schema.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:putValidationErrorOnDeadLetterQueue</td>
      <td style="vertical-align: top; font-family: monospace;">false</td>
      <td style="vertical-align: top;">Whether to put any messages
which fail validation onto the dead letter queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:compressBinaryMessages</td>
      <td style="vertical-align: top; font-family: monospace;">false</td>
      <td style="vertical-align: top;">Whether to compress binary
messages put onto the request queue using GZIP.</td>
    </tr>
  </tbody>
</table>
<br>
The attributes in the <span style="font-family: monospace;">emi:soap</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:sourceName</td>
      <td style="vertical-align: top; font-family: monospace;">Message
Source</td>
      <td style="vertical-align: top;">Arbitrary name for the connector
source.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:destinationName</td>
      <td style="vertical-align: top; font-family: monospace;">Message
Destination</td>
      <td style="vertical-align: top;">Arbitrary name for the connector
destination.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:useSOAPEnvelope</td>
      <td style="vertical-align: top; font-family: monospace;">false</td>
      <td style="vertical-align: top;">Whether to wrap the XML messages
in a SOAP envelope.</td>
    </tr>
  </tbody>
</table>
<br>
The attributes in the <span style="font-family: monospace;">emi:request-reply-connection</span>
element are as follows:<br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <th style="vertical-align: top;">Attribute</th>
      <th style="vertical-align: top;">Example Value</th>
      <th style="vertical-align: top;">Description</th>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:requestQueueName</td>
      <td style="vertical-align: top; font-family: monospace;">RequestQueue</td>
      <td style="vertical-align: top;">The JNDI name of the request
queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:replyQueueName<br>
      </td>
      <td style="vertical-align: top; font-family: monospace;">ReplyQueue<br>
      </td>
      <td style="vertical-align: top;">The JNDI name of the reply
queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:deadLetterQueueName</td>
      <td style="vertical-align: top; font-family: monospace;">DeadLetterQueue</td>
      <td style="vertical-align: top;">The JNDI name of the dead letter
queue.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:requestQueueConnFactoryName</td>
      <td style="vertical-align: top; font-family: monospace;">QueueConnectionFactory</td>
      <td style="vertical-align: top;">The JNDI name of the request
queue connection factory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:messageClassName</td>
      <td style="vertical-align: top; font-family: monospace;">javax.jms.TextMessage</td>
      <td style="vertical-align: top;">The type of message which will
be put onto the request queue.<span style="font-family: serif;">*</span></td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:requesterClassName</td>
      <td style="vertical-align: top;">See Below<span
 style="font-family: serif;">**</span></td>
      <td style="vertical-align: top;">This is the class name of the
message requester to be used to handle the request-reply.<span
 style="font-family: serif;">**</span></td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:messageTimeToLive</td>
      <td style="vertical-align: top; font-family: monospace;">0<br>
      </td>
      <td style="vertical-align: top;">The time in milliseconds that
the message will stay alive on the queue before being deleted. <span
 style="font-family: monospace;">0</span> means forever.</td>
    </tr>
    <tr>
      <td style="vertical-align: top; font-family: monospace;">emi:replyWaitTime</td>
      <td style="vertical-align: top; font-family: monospace;">20000<br>
      </td>
      <td style="vertical-align: top;">The time in milliseconds that
the messaging infrastructure will wait for a reply before timing out.</td>
    </tr>
  </tbody>
</table>
<br>
* Can be one of the following: <span style="font-family: monospace;">javax.jms.BytesMessage,
javax.jms.TextMessage, javax.jms.ObjectMessage, or
javax.jms.StreamMessage.</span><br>
<br>
** Can be one of the following: <span style="font-family: monospace;">nz.co.pukeko.msginf.client.connector.ConsumerMessageRequester
or
nz.co.pukeko.msginf.client.connector.FutureResultsHandlerMessageRequester.</span>
The <span style="font-family: monospace;">ConsumerMessageRequester</span>
uses a standard JMS MessageProducer/MessageConsumer to handle the
request-reply. The <span style="font-family: monospace;">FutureResultsHandlerMessageRequester</span>
uses a <span style="font-family: monospace;">EDU.oswego.cs.dl.util.concurrent.FutureResult</span>
class which keeps track of the correlation ID's and implements the <span
 style="font-family: monospace;">javax.jms.MessageListener</span>
interface to get replies of the reply queue.<br>
<br>
The <span style="font-family: monospace;">FutureResultsHandlerMessageRequester</span>
requester is faster than the <span style="font-family: monospace;">ConsumerMessageRequester</span>
requester though not all of the messaging systems can use it. The <span
 style="font-family: monospace;">ConsumerMessageRequester</span>
requester will work with all JMS 1.1 compliant messaging systems but
the <span style="font-family: monospace;">FutureResultsHandlerMessageRequester</span>
requester works only with ActiveMQ 3.1 and JBossMQ 4.0. As it doesn't
run in multiple threads, it is considered experimental and should not
be used in all situations.<br>
<br>
For example, JORAM 4.2.0 generates the following exception with the <span
 style="font-family: monospace;">FutureResultsHandlerMessageRequester</span>
requester:<br>
<br>
<span style="font-family: monospace;">ERROR [Thread-0]
(MessageController.java:259) - Illegal control thread</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">javax.jms.IllegalStateException:
Illegal control thread</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
org.objectweb.joram.client.jms.Session.checkThreadOfControl(Session.java:376)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at org.objectweb.joram.client.jms.Session.send(Session.java:1795)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
org.objectweb.joram.client.jms.MessageProducer.doSend(MessageProducer.java:381)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
org.objectweb.joram.client.jms.MessageProducer.send(MessageProducer.java:306)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
nz.co.pukeko.msginf.client.connector.BaseMessageRequester.doSend(BaseMessageRequester.java:61)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
nz.co.pukeko.msginf.client.connector.FutureResultsHandlerMessageRequester.request(FutureResultsHandlerMessageRequester.java:54)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
nz.co.pukeko.msginf.client.connector.MessageController.sendMessage(MessageController.java:236)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
nz.co.pukeko.msginf.client.adapter.QueueManager.putMessageOnQueue(QueueManager.java:197)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
nz.co.pukeko.msginf.client.adapter.QueueManager.sendMessage(QueueManager.java:164)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
nz.co.pukeko.msginf.client.adapter.QueueManager.sendMessage(QueueManager.java:108)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at
nz.co.pukeko.msginf.client.adapter.TestQueueManagerMessageHandler.run(TestQueueManagerMessageHandler.java:147)</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
at java.lang.Thread.run(Thread.java:595)</span><br>
<h4><a name="Calling_the_Messaging_Infrastructure"></a>Calling the
Messaging Infrastructure</h4>
The following is an example of the messaging infrastructure calling the
<span style="font-family: monospace;">activemq</span> messaging system
and the <span style="font-family: monospace;">activemq_rr_text_consumer</span>
connector as defined in the <span style="font-family: monospace;">msginf.xml</span>
file:<br>
<br>
<span style="font-family: monospace;">String someXML =
"&lt;Request&gt;...&lt;/Request&gt;";</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">QueueManager qm = new
QueueManager("activemq");</span><br style="font-family: monospace;">
<span style="font-family: monospace;">Object reply =
queueManager.sendMessage("activemq_rr_text_consumer", someXML);</span><br
 style="font-family: monospace;">
<br>
It is up to the calling application to know what Object is going to be
returned by the messaging infrastructure.<br>
<br>
Message header properties can be sent using the <span
 style="font-family: monospace;">nz.co.pukeko.msginf.infrastructure.data.HeaderProperties</span>
class, which class extends <span style="font-family: monospace;">java.util.HashMap</span>.
This class is used to store the message header properties and is passed
to the messaging infrastructure using the <span
 style="font-family: monospace;">QueueManager.sendMessage</span> method.<br>
<br>
The interface the <span style="font-family: monospace;">QueueManager</span>
class implements has the following methods:<br>
<br>
<span style="font-family: monospace;">public Object sendMessage(String
connector, String message) throws MessageException;</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">public Object sendMessage(String
connector, OutputStream messageStream) throws MessageException;</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">public Object sendMessage(String
connector, String message, HeaderProperties headerProperties) throws
MessageException;</span><br style="font-family: monospace;">
<span style="font-family: monospace;">public Object sendMessage(String
connector, OutputStream messageStream, HeaderProperties
headerProperties) throws MessageException;</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">public void close();</span><br>
<hr style="width: 100%; height: 2px;"><span style="font-family: serif;"></span><a
 href="../index.html">Index</a>
</body>
</html>
